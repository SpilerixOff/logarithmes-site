<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Logarithmes ‚Äî v16.1.2 (boutons robustes)</title>
<style>
:root{--bg:#060912;--card:#0e1521;--ink:#eaf2ff;--muted:#a6b6c9;--line:#182334}
*{box-sizing:border-box}
html{background:var(--bg)} body{margin:0;color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto}
.container{max-width:1120px;margin:0 auto;padding:16px;position:relative;z-index:1}
.nav{position:sticky;top:0;z-index:6;background:#0b1423cc;backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
.nav-inner{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 16px}
.brand{font-weight:900}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.btn{background:#18263e;border:1px solid #22324a;color:#eaf2ff;padding:10px 12px;border-radius:12px;cursor:pointer;text-decoration:none}
.btn.alt{background:linear-gradient(180deg,#8a7dff,#6b5bff);border:none}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;margin-top:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px}
.small{color:var(--muted);font-size:14px}
.input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #22324a;background:#0b1423;color:#eaf2ff}
.tutor{position:fixed;left:50%;transform:translateX(-50%);bottom:84px;z-index:7;width:min(780px,94%);background:#0e1521;border:1px solid #22324a;border-radius:16px;padding:12px;box-shadow:0 18px 48px -18px #000c;display:none}
.t-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.t-close{background:#1a2336;border:1px solid #2a3b5c;color:#bcd; width:36px; height:36px;border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer}
.step{padding:8px;border-radius:10px;margin:6px 0;border:1px dashed #2a3d5b}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body>
<nav class="nav">
  <div class="nav-inner">
    <div class="brand">üìö Logarithmes</div>
    <div class="row">
      <a class="btn" href="print_fiche.html" target="_blank">üñ®Ô∏è Fiche PDF</a>
      <a class="btn" href="controle_imprimable.html" target="_blank">üìù Contr√¥le imprimable</a>
      <a class="btn" href="graph.html" target="_blank">üìà Page Graphique</a>
      <button id="btnTutor" class="btn alt">‚ùì Tuto</button>
    </div>
  </div>
</nav>

<div class="container">
  <section class="card">
    <h1>Calculs + Aide pas-√†-pas</h1>
    <p class="small">Tutoriel interactif, g√©n√©rateur d‚Äôexercices, et calculatrice (non incluse ici pour simplifier le patch).</p>
    <div class="grid">
      <div class="card">
        <h3>üéì Tutoriel interactif</h3>
        <p class="small">R√®gles produit/quotient/puissance + √©quations (expo/log/ln). Bouton ci-dessus.</p>
        <button id="btnTutor2" class="btn alt">Commencer</button>
      </div>
      <div class="card">
        <h3>üß™ G√©n√©rateur d‚Äôexercices</h3>
        <div class="row">
          <button class="btn" id="btnGenB">Combiner des logs</button>
          <button class="btn" id="btnGenC">√âquation ln</button>
          <button class="btn" id="btnGenD">√âquation expo</button>
        </div>
        <div id="qBox" class="card" style="margin-top:8px"></div>
        <div class="row" style="margin-top:6px">
          <input id="ans" class="input" placeholder="R√©ponse (ex: ln(10)/ln(2), 2^3, log(0.01))">
          <button id="btnCheck" class="btn">V√©rifier</button>
        </div>
        <div id="fb" class="small" style="min-height:20px;margin-top:4px"></div>
      </div>
      <div class="card">
        <h3>üìå M√©mo calculs</h3>
        <div class="small">
          <div>Produit : \( \log_a(xy)=\log_a x+\log_a y \)</div>
          <div>Quotient : \( \log_a(\tfrac{x}{y})=\log_a x-\log_a y \)</div>
          <div>Puissance : \( \log_a(x^r)=r\,\log_a x \)</div>
          <div>Ch. de base : \( \log_a x=\frac{\ln x}{\ln a} \)</div>
          <div>M√©thode : Domaine ‚Üí Regrouper ‚Üí Exponentialiser ‚Üí V√©rifier</div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Tutor panel -->
<div id="tPanel" class="tutor">
  <div class="t-header"><b id="tTitle">Tutoriel</b><button id="btnCloseT" class="t-close">‚úï</button></div>
  <div id="tBox"></div>
  <div class="row" style="margin-top:6px">
    <button id="btnMore" class="btn">Encore</button>
    <button id="btnNext" class="btn">Suivant</button>
    <button id="btnAlt" class="btn">Pas compris ‚Üí expliquer autrement</button>
  </div>
  <div id="tQuiz"></div>
</div>

<script>
// --- Safe KaTeX render helper
function mjx(el){ try{ if(window.renderMathInElement) renderMathInElement(el); } catch(e){} }

// --- Tutor data & logic
const T=[
  {title:'R√®gle PRODUIT', parts:[
    'Formule : \\\\( \\\\log_a(xy)=\\\\log_a x+\\\\log_a y \\\\).',
    'Astuce : multiplier **√† l\\'int√©rieur** ‚Üí additionner **√† l\\'ext√©rieur**.',
    'Exemple : \\\\( \\\\log(200)=\\\\log(2\\\\cdot 100)=\\\\log2+\\\\log100=\\\\log2+2 \\\\).'
  ], alt:'Multiplie les facteurs ‚áí additionne les logs.'},
  {title:'R√®gle QUOTIENT', parts:[
    'Formule : \\\\( \\\\log_a(\\\\tfrac{x}{y})=\\\\log_a x-\\\\log_a y \\\\).',
    'Astuce : diviser dedans ‚Üí soustraire dehors.',
    'Exemple : \\\\( \\\\log(\\\\tfrac{1}{100})=0-2=-2 \\\\).'
  ], alt:'Diviser enl√®ve du ‚Äúpoids‚Äù ‚áí soustraction.'},
  {title:'R√®gle PUISSANCE', parts:[
    'Formule : \\\\( \\\\log_a(x^r)=r\\\\,\\\\log_a x \\\\).',
    'Astuce : l\\'exposant **descend** devant.',
    'Exemple : \\\\( \\\\log(10^3)=3 \\\\).'
  ], alt:'L\\'exposant devient un facteur : on gagne du temps.'},
  {title:'√âquations simples', parts:[
    'Expo : \\\\( a^x=b \\\\Rightarrow x=\\\\dfrac{\\\\ln b}{\\\\ln a} \\\\).',
    'Log : \\\\( \\\\log_a x=c \\\\Rightarrow x=a^c \\\\).',
    'Ln : \\\\( 2\\\\ln(x+1)=\\\\ln3+\\\\ln(2x-1) \\\\Rightarrow (x+1)^2=6x-3 \\\\Rightarrow x=2 \\\\).'
  ], alt:'Toujours : Domaine ‚Üí Regrouper ‚Üí Exponentialiser ‚Üí V√©rifier.'},
];
let ti=0, td=0;
function openTutor(){ document.getElementById('tPanel').style.display='block'; ti=0; td=0; renderTutor(); }
function closeTutor(){ document.getElementById('tPanel').style.display='none'; }
function tMore(){ td=Math.min(td+1,2); renderTutor(); }
function tNext(){ if(ti<T.length-1){ ti++; td=0; renderTutor(); } else showTQuiz(); }
function tAlt(){ const box=document.getElementById('tBox'); box.innerHTML='<div class="step">'+T[ti].alt+'</div>'; mjx(box); }
function renderTutor(){
  const s=T[ti]; document.getElementById('tTitle').textContent=s.title;
  const html = s.parts.slice(0,td+1).map((p)=>'<div class="step">'+p+'</div>').join('');
  const box=document.getElementById('tBox'); box.innerHTML=html; mjx(box); document.getElementById('tQuiz').innerHTML='';
}
function showTQuiz(){
  const Q=[
    {q:'\\\\(\\\\log(25)+\\\\log(4)=?\\\\)', a:'2'},
    {q:'\\\\(\\\\log(\\\\tfrac{20}{5})=?\\\\)', a:'\\\\log(4)'},
    {q:'\\\\(\\\\log(\\\\sqrt{10})=?\\\\)', a:'1/2'}
  ]; const cur=Q[ti%Q.length];
  const tQ=document.getElementById('tQuiz');
  tQ.innerHTML = '<div class="step"><b>Quiz :</b> '+cur.q+'<div class="row" style="margin-top:6px">\
    <input id="tAnswer" class="input" style="width:220px" placeholder="Ta r√©ponse">\
    <button id="btnVerify" class="btn">V√©rifier</button></div><div id="tFb" class="small"></div></div>';
  mjx(tQ);
  document.getElementById('btnVerify').addEventListener('click', ()=>{
     const v=(document.getElementById('tAnswer').value||'').replace(/\\s+/g,'').replace(',','.');
     const s=cur.a.replace(/\\s+/g,'');
     document.getElementById('tFb').innerHTML = (v===s)? '‚úîÔ∏è Correct' : '‚úñÔ∏è R√©essaie : applique la r√®gle.';
  });
}

// --- Exercise generator + evaluator
function rnd(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function gen(type){
  let ex={};
  if(type==='B'){ const a=rnd(2,9), b=rnd(2,9), k=rnd(2,4); ex={t:'\\\\( \\\\log '+a+'+'+k+'\\\\,\\\\log '+b+'=\\\\log(?) \\\\)', ans:a*(b**k), hint:'k log b = log(b^k).'}; }
  if(type==='D'){ const base=[2,3,4,5][rnd(0,3)], val=rnd(8,90); ex={t:'\\\\( '+base+'^x='+val+' \\\\)', ans:(Math.log(val)/Math.log(base)), hint:'x=ln('+val+')/ln('+base+')'}; }
  if(type==='C'){ const c=rnd(1,4), d=rnd(2,6); ex={t:'\\\\( \\\\ln(x+'+c+')+\\\\ln('+d+'x-1)=\\\\ln '+(c*d)+' \\\\)', ans:2, hint:'ln(a)+ln(b)=ln(ab).'}; }
  const qBox=document.getElementById('qBox'); qBox.innerHTML = ex.t; qBox.dataset.ans = ex.ans; qBox.dataset.hint = ex.hint; mjx(qBox);
  document.getElementById('ans').value=''; document.getElementById('fb').textContent='';
}
function evalExpr(expr){
  if(!expr) return NaN; let s=String(expr).toLowerCase().replaceAll(',','.');
  if(/[^0-9+\\-*/^()., \\t a-z]/.test(s)) return NaN; s=s.replaceAll('^','**'); s=s.replaceAll('ln','Math.log');
  const LOG=(x)=> (Math.log10?Math.log10(x):(Math.log(x)/Math.LN10));
  try{ return Function('Math','LOG','return ('+s+')')(Math,LOG); }catch(e){ return NaN; }
}
function check(){
  const ans=parseFloat(document.getElementById('qBox').dataset.ans);
  const val=evalExpr(document.getElementById('ans').value);
  const fb=document.getElementById('fb');
  if(Number.isFinite(val) && Math.abs(val-ans)<=1e-3){ fb.textContent='‚úîÔ∏è Correct'; fb.style.color='#67ddb5'; }
  else{ fb.textContent='‚úñÔ∏è Pas encore. Indice : '+(document.getElementById('qBox').dataset.hint||''); fb.style.color='#ffd6e3'; }
}

// --- Robust button binding (DOMContentLoaded + fallback timer)
function bindAll(){
  const map=[
    ['btnTutor', openTutor], ['btnTutor2', openTutor],
    ['btnCloseT', closeTutor],
    ['btnMore', tMore], ['btnNext', tNext], ['btnAlt', tAlt],
    ['btnGenB', ()=>gen('B')], ['btnGenC', ()=>gen('C')], ['btnGenD', ()=>gen('D')],
    ['btnCheck', check]
  ];
  map.forEach(([id,fn])=>{ const el=document.getElementById(id); if(el && !el.__bound){ el.addEventListener('click', fn); el.__bound=true; } });
}
document.addEventListener('DOMContentLoaded', bindAll);
// fallback in case some SPA/hydration delayed things
let tries=0; const int=setInterval(()=>{ tries++; bindAll(); if(tries>20) clearInterval(int); }, 200);
</script>
</body>
</html>